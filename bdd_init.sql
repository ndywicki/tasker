DROP TABLE authority;
CREATE TABLE authority (name varchar(50) NOT NULL, PRIMARY KEY (name)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
INSERT INTO authority (name) VALUES ('ROLE_ADMIN');
INSERT INTO authority (name) VALUES ('ROLE_USER');
DROP TABLE databasechangelog;
CREATE TABLE databasechangelog (ID varchar(255) NOT NULL, AUTHOR varchar(255) NOT NULL, FILENAME varchar(255) NOT NULL, DATEEXECUTED datetime NOT NULL, ORDEREXECUTED int NOT NULL, EXECTYPE varchar(10) NOT NULL, MD5SUM varchar(35), DESCRIPTION varchar(255), COMMENTS varchar(255), TAG varchar(255), LIQUIBASE varchar(20), CONTEXTS varchar(255), LABELS varchar(255), DEPLOYMENT_ID varchar(10)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, EXECTYPE, MD5SUM, DESCRIPTION, COMMENTS, TAG, LIQUIBASE, CONTEXTS, LABELS, DEPLOYMENT_ID) VALUES ('00000000000001', 'ndywicki', 'config/liquibase/changelog/00000000000000_initial_schema.xml', '2017-07-27 08:55:23', 1, 'EXECUTED', '7:5ceed984ced86ab66079854887c99dd4', 'createTable tableName=user; createIndex indexName=idx_user_login, tableName=user; createIndex indexName=idx_user_email, tableName=user; createTable tableName=authority; createTable tableName=user_authority; addPrimaryKey tableName=user_authority; ...', '', null, '3.5.3', null, null, '1145723082');
INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, EXECTYPE, MD5SUM, DESCRIPTION, COMMENTS, TAG, LIQUIBASE, CONTEXTS, LABELS, DEPLOYMENT_ID) VALUES ('00000000000002', 'ndywicki', 'config/liquibase/changelog/00000000000000_initial_schema.xml', '2017-07-27 08:55:24', 2, 'EXECUTED', '7:3491fe8b95ca59e884fabe750952c54a', 'createTable tableName=oauth_client_details; createTable tableName=oauth_client_token; addForeignKeyConstraint baseTableName=oauth_client_token, constraintName=fk_oauth_client_token_username, referencedTableName=user; createTable tableName=oauth_ac...', '', null, '3.5.3', null, null, '1145723082');
INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, EXECTYPE, MD5SUM, DESCRIPTION, COMMENTS, TAG, LIQUIBASE, CONTEXTS, LABELS, DEPLOYMENT_ID) VALUES ('20170725133822-1', 'ndywicki', 'config/liquibase/changelog/20170725133822_added_entity_Task.xml', '2017-07-27 08:55:24', 3, 'EXECUTED', '7:6057013c654948bac9dcb690e12c9dbd', 'createTable tableName=task', '', null, '3.5.3', null, null, '1145723082');
INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, EXECTYPE, MD5SUM, DESCRIPTION, COMMENTS, TAG, LIQUIBASE, CONTEXTS, LABELS, DEPLOYMENT_ID) VALUES ('20170725133822-2', 'ndywicki', 'config/liquibase/changelog/20170725133822_added_entity_constraints_Task.xml', '2017-07-27 08:55:24', 4, 'EXECUTED', '7:c64c26205d0917ad8f40140828341e43', 'addForeignKeyConstraint baseTableName=task, constraintName=fk_task_user_id, referencedTableName=user', '', null, '3.5.3', null, null, '1145723082');
DROP TABLE databasechangeloglock;
CREATE TABLE databasechangeloglock (ID int NOT NULL, LOCKED bit NOT NULL, LOCKGRANTED datetime, LOCKEDBY varchar(255), PRIMARY KEY (ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
INSERT INTO databasechangeloglock (ID, LOCKED, LOCKGRANTED, LOCKEDBY) VALUES (1, false, null, null);
DROP TABLE oauth_access_token;
CREATE TABLE oauth_access_token (token_id varchar(255), token blob, authentication_id varchar(255) NOT NULL, user_name varchar(50), client_id varchar(255), authentication blob, refresh_token varchar(255), PRIMARY KEY (authentication_id), INDEX fk_oauth_access_token_username (user_name)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
DROP TABLE oauth_approvals;
CREATE TABLE oauth_approvals (userId varchar(255), clientId varchar(255), scope varchar(255), status varchar(255), expiresAt timestamp NULL, lastModifiedAt timestamp NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8;
DROP TABLE oauth_client_details;
CREATE TABLE oauth_client_details (client_id varchar(255) NOT NULL, resource_ids varchar(255), client_secret varchar(255), scope varchar(255), authorized_grant_types varchar(255), web_server_redirect_uri varchar(255), authorities varchar(255), access_token_validity int, refresh_token_validity int, additional_information varchar(4000), autoapprove varchar(4000), PRIMARY KEY (client_id)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
INSERT INTO oauth_client_details (client_id, resource_ids, client_secret, scope, authorized_grant_types, web_server_redirect_uri, authorities, access_token_validity, refresh_token_validity, additional_information, autoapprove) VALUES ('taskerapp', 'res_tasker', 'tasker-secret-token', 'read,write', 'password,refresh_token,authorization_code,implicit', '', 'ROLE_ADMIN,ROLE_USER', 1800, 2000, '{}', 'true');
DROP TABLE oauth_client_token;
CREATE TABLE oauth_client_token (token_id varchar(255), token blob, authentication_id varchar(255), user_name varchar(50), client_id varchar(255), INDEX fk_oauth_client_token_username (user_name)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
DROP TABLE oauth_code;
CREATE TABLE oauth_code (code varchar(255), authentication blob) ENGINE=InnoDB DEFAULT CHARSET=utf8;
DROP TABLE oauth_refresh_token;
CREATE TABLE oauth_refresh_token (token_id varchar(255), token blob, authentication blob) ENGINE=InnoDB DEFAULT CHARSET=utf8;
DROP TABLE task;
CREATE TABLE task (id bigint NOT NULL AUTO_INCREMENT, title varchar(255), completed bit, user_id bigint, PRIMARY KEY (id), INDEX fk_task_user_id (user_id)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
DROP TABLE user;
CREATE TABLE user (id bigint NOT NULL AUTO_INCREMENT, login varchar(50) NOT NULL, password_hash varchar(60), first_name varchar(50), last_name varchar(50), email varchar(100), activated bit NOT NULL, lang_key varchar(5), PRIMARY KEY (id), CONSTRAINT login UNIQUE (login), CONSTRAINT idx_user_login UNIQUE (login), CONSTRAINT email UNIQUE (email), CONSTRAINT idx_user_email UNIQUE (email)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
INSERT INTO user (id, login, password_hash, first_name, last_name, email, activated, lang_key) VALUES (1, 'system', '$2a$10$mE.qmcV0mFU5NcKh73TZx.z4ueI/.bDWbj0T1BYyqP481kGGarKLG', 'System', 'System', 'system@localhost', true, 'en');
INSERT INTO user (id, login, password_hash, first_name, last_name, email, activated, lang_key) VALUES (2, 'anonymoususer', '$2a$10$j8S5d7Sr7.8VTOYNviDPOeWX8KcYILUVJBsYV83Y5NtECayypx9lO', 'Anonymous', 'User', 'anonymous@localhost', true, 'en');
INSERT INTO user (id, login, password_hash, first_name, last_name, email, activated, lang_key) VALUES (3, 'admin', '$2a$10$gSAhZrxMllrbgj/kkK9UceBPpChGWJA7SYIb1Mqo.n5aNLq1/oRrC', 'Administrator', 'Administrator', 'admin@localhost', true, 'en');
INSERT INTO user (id, login, password_hash, first_name, last_name, email, activated, lang_key) VALUES (4, 'user', '$2a$10$VEjxo0jq2YG9Rbk2HmX9S.k1uZBGYUHdUcid3g/vfiEl7lwWgOH/K', 'User', 'User', 'user@localhost', true, 'en');
DROP TABLE user_authority;
CREATE TABLE user_authority (user_id bigint NOT NULL, authority_name varchar(50) NOT NULL, PRIMARY KEY (user_id, authority_name), INDEX fk_authority_name (authority_name)) ENGINE=InnoDB DEFAULT CHARSET=utf8;
INSERT INTO user_authority (user_id, authority_name) VALUES (1, 'ROLE_ADMIN');
INSERT INTO user_authority (user_id, authority_name) VALUES (3, 'ROLE_ADMIN');
INSERT INTO user_authority (user_id, authority_name) VALUES (1, 'ROLE_USER');
INSERT INTO user_authority (user_id, authority_name) VALUES (3, 'ROLE_USER');
INSERT INTO user_authority (user_id, authority_name) VALUES (4, 'ROLE_USER');
ALTER TABLE oauth_access_token ADD CONSTRAINT fk_oauth_access_token_username FOREIGN KEY (user_name) REFERENCES user (login);
ALTER TABLE oauth_client_token ADD CONSTRAINT fk_oauth_client_token_username FOREIGN KEY (user_name) REFERENCES user (login);
ALTER TABLE task ADD CONSTRAINT fk_task_user_id FOREIGN KEY (user_id) REFERENCES user (id);
ALTER TABLE user_authority ADD CONSTRAINT fk_authority_name FOREIGN KEY (authority_name) REFERENCES authority (name) ;
ALTER TABLE user_authority ADD CONSTRAINT fk_user_id FOREIGN KEY (user_id) REFERENCES user (id);
